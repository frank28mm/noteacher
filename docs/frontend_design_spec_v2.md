# Frontend Development Specification (v2.2)
**Source of Truth for "Homework Master" Frontend Engineering**
**Last Updated**: 2026-01-04

æ­¤æ–‡æ¡£ä½œä¸ºå‰ç«¯å¼€å‘çš„**å”¯ä¸€çœŸç†æ¥æº**ï¼Œå·²æ•´åˆ Stitch UI è®¾è®¡ç¨¿ä¸åç«¯å·¥ç¨‹å¸ˆçš„å¯è¡Œæ€§åé¦ˆã€‚**v2.2 ç‰ˆæœ¬æ˜ç¡®äº†â€œåˆ†é˜¶æ®µè½åœ°â€ç­–ç•¥**ï¼Œä¼˜å…ˆä¿è¯æ ¸å¿ƒé“¾è·¯çš„å•†ä¸šåŒ–ä½“éªŒã€‚

## 0. å£å¾„å¯¹é½ï¼ˆé¿å…â€œå¤–éƒ¨æ€»ç»“â€è¯¯å¯¼åä½œï¼‰

å¤–éƒ¨ã€Šé¡¹ç›®å…¨é¢ä½“æ£€æŠ¥å‘Šã€‹é‡Œæœ‰éƒ¨åˆ†è¡¨è¿°ä¸å½“å‰ä»£ç ä¸ä¸€è‡´ï¼ˆä¾‹å¦‚ SSE å®¢æˆ·ç«¯å®ç°ã€ç«¯ç‚¹æ•°é‡ã€ç±»å‹ â€œno anyâ€ ç»“è®ºï¼‰ã€‚å·²å®Œæˆä»£ç æ ¸å¯¹å¹¶ç»Ÿä¸€å£å¾„ï¼š

- ä»£ç æ ¸å¯¹æŠ¥å‘Šï¼š`docs/reports/healthcheck_report_code_alignment_20260103.md`
- éœ€è¦å‰ç«¯ç‰¢è®°çš„ä¸‰ç‚¹ï¼š
  - **Chat SSE å®¢æˆ·ç«¯**ï¼šæœ¬é¡¹ç›® `/api/v1/chat` æ˜¯ **POST + SSE å“åº”**ï¼›demo å‰ç«¯ç”¨ `fetch + ReadableStream` è§£æ SSEï¼ˆä¸æ˜¯ EventSourceï¼‰ã€‚
  - **æ–­çº¿ç»­æ¥**ï¼šåç«¯æ”¯æŒ `Last-Event-Id`ï¼ˆæ¢å¤ session + æœ€å¤šé‡æ”¾ 3 æ¡ assistantï¼‰ï¼Œä½†å½“å‰å‰ç«¯æœªæ¥å…¥è¯¥ headerï¼ˆæœªæ¥å¯è¡¥ï¼Œä¸å½±å“éªŒæ”¶ä¸»é“¾è·¯ï¼‰ã€‚
  - **ç±»å‹â€œå…¨ç»¿â€ä¸æ˜¯ç°çŠ¶**ï¼šæ ¸å¿ƒé“¾è·¯ types å·²å¯¹é½ï¼Œä½†ä»å­˜åœ¨å°‘é‡ `any`/ç±»å‹é€ƒé€¸ï¼ˆè®¡åˆ’åœ¨ç¨³å®šåæ¸…å€ºï¼‰ã€‚

---

## 0.1 å½“å‰è”è°ƒéªŒæ”¶çŠ¶æ€ï¼ˆP0/P1ï¼‰

> è¯´æ˜ï¼šæ­¤å¤„ä»…è®°å½•â€œæ˜¯å¦å·²è·‘é€š/å¯éªŒæ”¶â€ï¼Œä¸é”æ­»æœ€ç»ˆ UIï¼ˆStitch è§†è§‰æ”¹ç‰ˆåä¼šå†è°ƒæ•´ç»„ä»¶ä¸äº¤äº’ï¼‰ã€‚

- âœ… Upload/Grade ä¸»é“¾è·¯ï¼š`POST /api/v1/uploads` â†’ `POST /api/v1/grade`ï¼ˆå‰ç«¯å›ºå®š `X-Force-Async: 1`ï¼‰â†’ `GET /api/v1/jobs/{job_id}` è½®è¯¢
- âœ… å¤šå›¾ä¸Šä¼ ï¼š`<input multiple>` + multipart `file` å¾ªç¯ `append`
- âœ… ç¨³å¥è½®è¯¢ï¼šåŠ¨æ€æœ€å¤§ç­‰å¾…æ—¶é—´ + é™é¢‘ï¼›åœæ­¢æ¡ä»¶ä¸º `(done/failed) AND (æ—  review_pending å¡)`
- âœ… Layer 3 å¤æ ¸å¡å¯éªŒæ”¶ï¼š`review_pending â†’ review_ready/review_failed` å¯åœ¨å‰ç«¯ç¨³å®šè§‚å¯Ÿ
- âœ… History/Recent Activityï¼š`GET /api/v1/submissions`ï¼ˆæƒå¨æ•°æ®æºï¼Œä¸ä¾èµ– `/mistakes`ï¼‰
- âœ… History Detailï¼ˆæ–¹æ¡ˆ Bï¼‰ï¼š`GET /api/v1/submissions/{submission_id}`ï¼ˆå¿«ç…§è¯¦æƒ…ç§’å¼€ï¼‰
- âœ… å†å²é”™é¢˜é—®è€å¸ˆï¼ˆRehydrateï¼‰ï¼š`POST /api/v1/chat` æ”¯æŒ `submission_id + context_item_ids`ï¼ˆæ— éœ€é‡æ–°ä¸Šä¼ ï¼‰
- âœ… Report è§£é”å£å¾„ï¼š`GET /api/v1/reports/eligibility`ï¼ˆåŸºäº submissionsï¼Œä¸ä¼šæ¼æ‰å…¨å¯¹ä½œä¸šï¼‰

## I. å…¨é“¾è·¯äº¤äº’çº¿ç¨¿ (Full-Link Wireframes)

### 1. é¦–é¡µ (Home Screen)
**åœºæ™¯**: ç”¨æˆ·å†·å¯åŠ¨æˆ–å›åˆ°é¦–é¡µã€‚

```text
+-----------------------------------+
|  MathMaster           [Avatar]    |
|                                   |
|      ( Animated AI Logo )         |
|                                   |
|   [      SCAN / UPLOAD      ]     |
|   +-----------------------+       |
|   | [ğŸ“· Camera] [ğŸ–¼ï¸ Album] |     | <-- åº•éƒ¨æ ¸å¿ƒæ“ä½œåŒº
|   +-----------------------+       |
|                                   |
| [ Recent Activity Card        ]   |
| | ğŸ•’ Today, 10:23             |   |
| | ğŸ“š Math Worksheet (-2)  >   |   |
| +-----------------------------+   |
|                                   |
| [ Home ] [Mistake] [Report] [Me]  |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   **(A) Dual Input (Phase 1: Native)**:
    *   **Camera**: è°ƒç”¨ `<input type="file" capture="environment" accept="image/*">`ã€‚
        *   *Decision*: æš‚ä¸ä½¿ç”¨ `getUserMedia` åšè‡ªå®šä¹‰å–æ™¯æ¡† (Phase 2)ï¼Œä¼˜å…ˆä¿è¯å…¼å®¹æ€§ä¸å¼€å‘æ•ˆç‡ã€‚
    *   **Album**: è°ƒç”¨ `<input type="file" accept="image/*">`ã€‚
    *   **Trigger**: æ–‡ä»¶é€‰ä¸­åç«‹å³è§¦å‘ `POST /api/v1/uploads` -> `POST /api/v1/grade` (Scheme A: `images: []`)ã€‚
### 1.1 è¿‡æ¸¡æ€ï¼šä¸Šä¼ ä¸­ (Transition: Uploading)
**åœºæ™¯**: é€‰å›¾åï¼Œå›¾ç‰‡æ­£åœ¨å‘é€ç»™æœåŠ¡å™¨ï¼Œä½†åˆ†æå°šæœªå¼€å§‹ã€‚
**Stitch UI å‚è€ƒ**: `å›¾ç‰‡ä¸Šä¼ ä¸­é¡µé¢`
**ç›®çš„**: å¡«è¡¥â€œç‚¹å‡»â€åˆ°â€œåˆ†æç•Œé¢â€ä¹‹é—´çš„ 200ms-1s ç©ºç™½ï¼Œé¿å…ç•Œé¢åƒµæ­»ã€‚

```text
+-----------------------------------+
|  (Overlay or Full Screen)         |
|                                   |
|        [ Thumbnail ]              |
|      (Spinner/Progress)           |
|                                   |
|    "Uploading Image (45%)..."     |
|                                   |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   æ˜¾ç¤ºæœ¬åœ°é¢„è§ˆå›¾ (Thumbnail)ã€‚
*   è¿›åº¦æ¡æˆ– Spinner æç¤ºä¸Šä¼ ã€‚
*   ä¸Šä¼ å®Œæ¯•æ”¶åˆ° response åï¼Œå¹³æ»‘è·³è½¬è‡³ "Analyzing"ã€‚

### 1.2 å†å²ä½œä¸šå…¥å£ (Entrance 2: History)
**åœºæ™¯**: é¦–é¡µç‚¹å‡» "Recent Activity" æˆ–åº•éƒ¨ [Report] -> History Listã€‚
**Stitch UI å‚è€ƒ**: `æŠ¥å‘Š æ ¹é¡µé¢` (History Section)
**Backend**: `GET /api/v1/submissions` å·²å®ç°ï¼ˆHistory List æ•°æ®æºï¼›ä¸å¾—ç”¨ `/mistakes` æ¨æ–­ï¼‰ã€‚

```text
+-----------------------------------+
|  HISTORY                          |
|                                   |
|  [ Search / Filter ]              |
|  +-----------------------------+  |
|  | ğŸ“„ Jan 05 - Math Worksheet  |  |
|  | Score: S  Mistakes: 2       |  |
|  | [ View > ]                  |  |
|  +-----------------------------+  |
|  | ğŸ“„ Jan 04 - English         |  |
|  | ...                         |  |
|  +-----------------------------+  |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘ï¼ˆå·²å®šï¼Œæ–¹æ¡ˆ Bï¼šå¿«ç…§è¯¦æƒ…ï¼‰**:
*   ç‚¹å‡» Item -> è¿›å…¥â€œä½œä¸šè¯¦æƒ…ï¼ˆHistory Detailï¼‰â€ï¼Œä»åç«¯è¯»å–å¿«ç…§æ¸²æŸ“ï¼Œä¸é‡å»º jobï¼š
    *   `GET /api/v1/submissions/{submission_id}`
    *   ä½¿ç”¨è¿”å›çš„ `question_cards/page_summaries/session_id` ç›´æ¥å±•ç¤ºå¡ç‰‡ä¸è¾…å¯¼å…¥å£
*   å¤‡æ³¨ï¼šæ—§ä½œä¸šè‹¥ `session_id` å¤±æ•ˆï¼Œç‚¹å‡»â€œé—®è€å¸ˆâ€èµ° **Chat Rehydrate**ï¼ˆ`POST /api/v1/chat` å¸¦ `submission_id`ï¼‰ã€‚


### 2. æ‰¹æ”¹ä¸­ (Analyzing State)
**åœºæ™¯**: å›¾ç‰‡å·²ä¸Šä¼ ï¼ŒAI æ­£åœ¨åˆ†æã€‚
**ç›®çš„**: æä¾›ç¡®å®šæ„Ÿï¼Œ**å¼ºåˆ¶åœç•™**ä»¥å±•ç¤ºç§‘æŠ€æ„ŸåŠ¨æ•ˆã€‚

```text
+-----------------------------------+
|                                   |
|      ( Lottie Animation )         |
|      [ Robot Scanning... ]        |
|                                   |
|     (Dynamic Status Text)         |
|   > "Identifying Questions..."    |
|     "Verifying Answers..."        |
|     "Generating Report..."        |
|                                   |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   **Min-Display Time**: å¼ºåˆ¶å±•ç¤ºè‡³å°‘ **1.5s**ã€‚
*   **Smooth Exit**: çŠ¶æ€å®Œæˆåï¼Œå†…å®¹æ·¡å‡ºï¼Œç»“æœé¡µæ·¡å…¥ã€‚
*   **Pollingï¼ˆé•¿ä»»åŠ¡ä¸â€œæŠ¥é”™å¡æ­»â€ï¼‰**:
    *   **è½®è¯¢è¶…æ—¶ä¸ç­‰äºå¤±è´¥**ï¼šä¸å¾—å› ä¸ºè¶…è¿‡å›ºå®šæ—¶é•¿å°±è¿›å…¥é”™è¯¯é¡µï¼›ä»åº”æŒç»­è¿½æ›´ï¼Œç›´åˆ°åç«¯ `job.status=done/failed`ã€‚
    *   **ä¸æ–°å¢â€œè¶…æ—¶åˆ†æ”¯æŒ‰é’®â€**ï¼šUI å§‹ç»ˆä¿æŒåŒä¸€æ¡ä¸»æµç¨‹ï¼ˆå¡ç‰‡é€æ­¥å‡ºç°å°±æ˜¯ç¡®å®šæ„Ÿï¼‰ï¼Œä¸å¼¹â€œä½œä¸šè¾ƒå¤š/ç»§ç»­ç­‰å¾…/è¿”å›â€ç­‰é¢å¤–åˆ†æ”¯æŒ‰é’®ã€‚
    *   **åŠ¨æ€æœ€å¤§ç­‰å¾…æ—¶é—´**ï¼š`max_wait = min(30min, max(10min, total_pages * 6min))`ï¼ˆä¾‹ï¼š3 é¡µè‡³å°‘ 18minï¼‰ã€‚
    *   **è®¡æ—¶åŸºå‡†**ï¼šä¼˜å…ˆä½¿ç”¨åç«¯è¿”å›çš„ `elapsed_ms`ï¼ˆé¿å…æµè§ˆå™¨åå° Tab é™é¢‘å¯¼è‡´å‰ç«¯ wall time è™šé«˜ï¼‰ã€‚
    *   **é™é¢‘è½®è¯¢**ï¼š
        *   0â€“2minï¼šæ¯ 2s
        *   2â€“10minï¼šæ¯ 5s
        *   10min+ï¼šæ¯ 10s
    *   **å¯æ¢å¤ï¼ˆå»ºè®®ï¼‰**ï¼šæŒä¹…åŒ– `job_id`ï¼ˆlocalStorageï¼‰ï¼Œåˆ·æ–°/è·³è½¬åå¯ç»§ç»­è¿½æ›´ï¼ˆå…¥å£å¯åç»­æ”¾åœ¨ Home çš„ Recent/Continueï¼‰ã€‚

### 3. ç»“æœé¡µ (Result Screen)
**åœºæ™¯**: æ‰¹æ”¹å®Œæˆï¼Œç”¨æˆ·æŸ¥çœ‹æœ¬æ¬¡ä½œä¸šæ¦‚è§ˆã€‚
**Stitch UI å‚è€ƒ**: `æ‰¹æ”¹ç»“æœ å…¨é‡å®Œæˆé¡µé¢`

```text
+-----------------------------------+
|  < Back   Grading Result          |
|                                   |
|  [ Page Tabs: 1 | 2 | 3       ]   | <-- å¤šé¡µåˆ‡æ¢
|                                   |
|  [ View Toggle: Mistakes | All ]  | <-- é»˜è®¤ Mistakes
|  +----------------------------+   |
|  | +------------------------+ |   |
|  | | Q1 (Wrong âŒ)          | |   |
|  | | [ Real Crop Image ]    | |   |
|  | |                        | |   |
|  | | Reason: Calculation... | |   |
|  | | [ Ask Teacher ]        | |   |
|  | +------------------------+ |   |
|  +----------------------------+   |
|                                   |
|  ( Indicator:  â€¢  o  o  o )       |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   **Default View**: é»˜è®¤å±•ç¤º `Mistakes` (é”™é¢˜/å­˜ç–‘/Pending)ï¼Œå‡å°‘ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…ã€‚æä¾› Toggle åˆ‡æ¢çœ‹ `All`ã€‚
*   **Progressive Toast**: å½“ `page_placeholders_ready` æˆ–æ–°é¢˜å‡ºç°æ—¶ï¼Œå¼¹å‡º Toast "ç¬¬ 2 é¡µå·²å¼€å§‹åˆ†æ..." å¹¶è‡ªåŠ¨å®šä½ã€‚
*   **Image Visualization**: å‰ç«¯åˆ©ç”¨ `page_image_url` + `bbox` å®æ—¶è£å‰ªã€‚
*   **å¤šé¡µæ¸è¿›æŠ«éœ²ï¼ˆé€é¡µå‡ºç°ï¼Œä¸å¿…ç­‰å…¨é‡å®Œæˆï¼‰**:
    *   **é¡¶éƒ¨è¿›åº¦æ¡/é¡µç­¾ï¼ˆä½ æçš„ UI æ–¹å‘ï¼‰**ï¼šæ˜¾ç¤º `Page 1/3, 2/3, 3/3`ï¼Œå¹¶å¯é™„æ¯é¡µæ‘˜è¦ï¼ˆé”™é¢˜/ä¸ç¡®å®š/æœªä½œç­”ï¼‰ã€‚
    *   **å·¦ä¾§é¡µæ¡ï¼ˆä½ æçš„ UI æ–¹å‘ï¼‰**ï¼šæ¯é¡µä¸€ä¸ªèŠ‚ç‚¹ï¼›å½“æ–°é¡µå‡ºç°å ä½å¡æ—¶ç«‹åˆ»é«˜äº®ï¼Œè®©ç”¨æˆ·æ„ŸçŸ¥â€œç¬¬äºŒé¡µ/ç¬¬ä¸‰é¡µå‡ºæ¥äº†â€ã€‚
    *   **æ¯é¡µå ä½å¡é¢„è§ˆï¼ˆå…³é”®ä½“éªŒï¼‰**ï¼š
        *   å½“åç«¯äº§å‡ºè¯¥é¡µå ä½å¡ï¼ˆ`page_placeholders_ready`ï¼‰æ—¶ï¼Œè¯¥é¡µåŒºåŸŸå±•ç¤º **2â€“3 å¼ å ä½å¡**ï¼ˆé¢˜å· + é¢˜å¹²å‰ 10â€“20 å­—ï¼‰ã€‚
        *   å½“è¯¥é¡µå®Œæˆï¼ˆ`page_done`ï¼‰æ—¶ï¼Œè¯¥é¡µå ä½å¡æ‰¹é‡ç¿»è½¬ä¸ºåˆ¤å®šå¡ï¼ˆå¯¹/é”™/ä¸ç¡®å®š/ç©ºé¢˜ï¼‰ã€‚
*   **é”™é¢˜ä¼˜å…ˆè§†å›¾ï¼ˆå‡å°‘è®¤çŸ¥è´Ÿæ‹…ï¼‰**:
    *   å»ºè®®é»˜è®¤æ˜¾ç¤ºâ€œé”™é¢˜/å­˜ç–‘å¡â€åˆ—è¡¨ï¼ˆå·¦å³æ»‘åŠ¨ Q1/Q2/â€¦ï¼‰ï¼Œå†å¯åˆ‡åˆ°â€œå…¨éƒ¨é¢˜å¡â€ã€‚
    *   â€œé”™é¢˜/å­˜ç–‘å¡â€é›†åˆè§„åˆ™ï¼ˆç¡®å®šæ€§ï¼‰ï¼š
        *   åŒ…å«ï¼š`verdict=incorrect`ã€`verdict=uncertain`ã€`card_state in {review_pending, review_ready, review_failed}`
        *   `answer_state=blank`ï¼ˆæœªä½œç­”ï¼‰é»˜è®¤ä¸ç®—é”™é¢˜ï¼Œå¯å•ç‹¬æ˜¾ç¤ºä¸ºç°è‰²å¡æˆ–åœ¨åº•éƒ¨æç¤ºæ•°é‡
    *   ç‚¹é”™é¢˜å¡ â†’ æ‰“å¼€ Chat Drawerï¼ˆè¯·æ±‚å¿…é¡»å¸¦ `context_item_ids=[item_id]`ï¼Œç¡®ä¿åªå¼•ç”¨è¯¥é¢˜è¯æ®ï¼‰ã€‚

### 4. é”™é¢˜æœ¬åˆ—è¡¨ (Mistake Book)
**åœºæ™¯**: ç‚¹å‡»åº•éƒ¨ [Mistake] Tabï¼Œæµè§ˆå†å²é”™é¢˜èšåˆã€‚

```text
+-----------------------------------+
|  Mistake Book                 [ğŸ”]|
|  [ All ] [ Math ] [ English ]     |
|                                   |
|  Today                            |
|  +-----------------------------+  |
|  | âŒ Q3: Algebra              |  |
|  | [ Crop Thumb ]  "x^2+..."   |  |
|  | [ Review > ]                |  |
|  +-----------------------------+  |
|  | âŒ Q5: Geometry             |  |
|  | [ Crop Thumb ]  "Angle A.." |  |
|  | [ Review > ]                |  |
|  +-----------------------------+  |
|                                   |
|  Yesterday                        |
|  ...                              |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   åˆ—è¡¨é¡¹ç‚¹å‡»åå¼¹å‡º **Mistake Detail Modal**ã€‚

### 5. é”™é¢˜è¯¦æƒ… (Mistake Detail Modal)
**åœºæ™¯**: ä»é”™é¢˜æœ¬ç‚¹å‡»æŸä¸€é¡¹ï¼ŒæŸ¥çœ‹è¯¦ç»†è§£æã€‚

```text
+-----------------------------------+
|  (Modal / Popup)               X  |
|                                   |
|  [     Full Question Crop      ]  |
|  [       (Zoomable)            ]  |
|                                   |
|  Status: âŒ Wrong                 |
|  Knowledge: [Algebra] [Function]  |
|                                   |
|  [ Analysis / Reason ]            |
|  "You missed the negative sign.." |
|                                   |
|  +-----------------------------+  |
|  | ğŸ’¬ Ask Teacher (Floating)   |  |
|  +-----------------------------+  |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   è¿™æ˜¯ Chat çš„ä¸»è¦å…¥å£ä¹‹ä¸€ã€‚
*   éœ€é€å‡º `submission_id` å’Œ `item_id` ä¾› Chat ä¸Šä¸‹æ–‡ä½¿ç”¨ã€‚

### 6. æŠ¥å‘Šä¸ç»Ÿè®¡ (Reports & History)
**åœºæ™¯**: ç‚¹å‡»åº•éƒ¨ [Report] Tabã€‚
**Stitch UI å‚è€ƒ**: `æŠ¥å‘Š å¸…é€‰é¡µé¢`, `æŠ¥å‘Š æ ¹é¡µé¢`
**Decision (Phase 1)**: æš‚ä¸åšè‡ªç”±æ—¥æœŸèŒƒå›´ `start_date/end_date`ï¼ˆä¸é˜»å¡ Stitch ä¸»é“¾è·¯ï¼‰ã€‚

```text
+-----------------------------------+
|  Study Report                     |
|                                   |
|  [ Date Picker: Last 7 Days v ]   | <-- Phase 1: é¢„è®¾çª—å£ï¼ˆ7/30/90ï¼‰ï¼Œæ˜ å°„åˆ° window_days
|  [ Subject: Math v            ]   |
|                                   |
|  [ Weekly Trend Chart ]           |
|  |  / \  /                    |   |
|  +----------------------------+   |
|                                   |
|  [ Generate Report Button ]       |
+-----------------------------------+
```
**ğŸ”— é€»è¾‘**:
*   **è§£é”é—¨æ§›**ï¼šå‰ç«¯è°ƒç”¨ `GET /api/v1/reports/eligibility` å†³å®šæ˜¯å¦å¯ç”ŸæˆæŠ¥å‘Šï¼ˆä¸è¶³åˆ™ç½®ç°æç¤ºï¼‰ã€‚
*   **æ—¥æœŸé€‰æ‹©å™¨ï¼ˆPhase 1ï¼‰**ï¼šå…ˆæ”¯æŒ 7/30/90 ç­‰é¢„è®¾çª—å£ï¼ˆ`window_days`ï¼‰ï¼Œä¸åšä»»æ„æ—¥æœŸèŒƒå›´ã€‚
*   **ç”ŸæˆæŒ‰é’®**ï¼š
    *   Demoï¼šä¼˜å…ˆç”Ÿæˆâ€œæœ¬æ¬¡ä½œä¸šæŠ¥å‘Šâ€ï¼ˆ`submission_id` æ¨¡å¼ï¼‰ã€‚
    *   äº§å“ï¼šç”Ÿæˆå‘¨æœŸæŠ¥å‘Šï¼ˆ`window_days` æ¨¡å¼ï¼‰ã€‚
*   è‡ªç”±æ—¥æœŸèŒƒå›´ï¼ˆPhase 2/3ï¼‰ï¼šéœ€è¦åç«¯æ”¯æŒ `start_date/end_date` åå†å¯ç”¨ã€‚

### 7. æˆ‘çš„ (Me / Settings)
**åœºæ™¯**: ç‚¹å‡»åº•éƒ¨ [Me] Tabã€‚
**Stitch UI å‚è€ƒ**: `ã€Œæˆ‘çš„ã€ é¡µé¢`
**Gap**: No Backend Auth/User Profile APIs. Static Implementation Only.

```text
+-----------------------------------+
|  My Profile                       |
|  [ Avatar ]  Test User            |
|                                   |
|  [ ğŸŒ Language: English/ä¸­æ–‡ ]    |
|  [ ğŸ”’ Privacy Policy        ]     |
|  [ â„¹ï¸ About Us              ]     |
|  [ ğŸ‘¤ Account Mgmt (Mock)   ]     |
+-----------------------------------+
```

### 8. å¯¹è¯ä¸è¾…å¯¼ (Chat Drawer)
**åœºæ™¯**: ä»ç»“æœé¡µæˆ–é”™é¢˜è¯¦æƒ…é¡µç‚¹å‡» "Ask Teacher"ã€‚

```text
+-----------------------------------+
|  (Drawer overlays EVERYTHING)  X  | <-- Layering: Z-Index Highest
|                                   |
|  AI Tutor (Context: Q3)           |
|                                   |
|  (Persistent History Area)        |
|  User: è¿™ä¸€æ­¥ä¸ºä»€ä¹ˆæ˜¯ -1?          |
|  AI: ç§»é¡¹å˜å·è§„åˆ™...               |
|      $$ a + b = 0 \to a = -b $$   | <-- LaTeX Rendered
|                                   |
|  [ Input...            ] [Send]   |
+-----------------------------------+
```
**æŠ€æœ¯çº¦æŸ (Technical Constraints)**:
*   **Persistence**: æŒ‰ `submission_id` + `item_id` åŒé”®ç¼“å­˜å†å²ã€‚
*   **Session Strategy**: 
    *   æ–°ä½œä¸šï¼šä½¿ç”¨å½“å‰ `session_id`ã€‚
    *   å†å²ä½œä¸šï¼ˆRehydrateï¼‰ï¼šé€šè¿‡ `submission_id + item_id` å‘åç«¯è¯·æ±‚æ¢å¤ä¼šè¯ã€‚
*   **Layering**: ä½¿ç”¨ React Portal æŒ‚è½½åˆ° bodyï¼Œç¡®ä¿è¦†ç›– Modalã€‚

---

## II. å…³é”®é¡µé¢æµè½¬å›¾ (Page Flow)

```mermaid
graph TD
    HOME[1. Home] -->|Upload| TRANS[1.1 Uploading]
    TRANS --> ANA[2. Analyzing]
    ANA --> RESULT[3. Result Screen]
    
    RESULT -->|Click Card| CHAT[7. Chat Drawer]
    
    HOME -->|Tab| MISTAKE_LIST[4. Mistake Book]
    MISTAKE_LIST -->|Click Item| MISTAKE_DETAIL[5. Mistake Detail]
    MISTAKE_DETAIL -->|Ask Teacher| CHAT
    
    HOME -->|Tab| REPORT[6. History]
    REPORT -->|Click Item| RESULT
```

è¿™ä»½æ–‡æ¡£è¡¥å…¨äº†è¿‡æ¸¡æ€ã€é”™é¢˜ç®¡ç†ä¸å†å²è®°å½•çš„å®Œæ•´è§†å›¾ï¼Œä¾›è®¾è®¡å¸ˆè¿›è¡Œå…¨æ¡ˆè®¾è®¡ã€‚

---

## III. éªŒæ”¶è¦ç‚¹ï¼ˆDoDï¼Œä¾¿äºè”è°ƒï¼‰

### 1) Pollingï¼ˆå¤šé¡µé•¿ä»»åŠ¡ä¸â€œå¡æ­»â€ï¼‰
- 3 é¡µä½œä¸šåœ¨ 10â€“20 åˆ†é’ŸåŒºé—´ï¼šå‰ç«¯ä¸å¾—è¿›å…¥é”™è¯¯é¡µï¼›å¿…é¡»æŒç»­å±•ç¤ºè¿›åº¦å¹¶æŒç»­æ›´æ–°å¡ç‰‡ã€‚
- è½®è¯¢é¢‘ç‡æŒ‰é˜¶æ®µé™é¢‘ï¼ˆ2sâ†’5sâ†’10sï¼‰ï¼Œä½†å¡ç‰‡æ›´æ–°ä¸ä¸¢å¤±ã€‚
- è®¡æ—¶å±•ç¤ºä½¿ç”¨åç«¯ `elapsed_ms`ï¼ˆé¿å…åå° Tab é™é¢‘é€ æˆ UI è¯¯åˆ¤ï¼‰ã€‚

### 2) å¤šé¡µæ¸è¿›æŠ«éœ²ï¼ˆç”¨æˆ·å¯æ„ŸçŸ¥â€œæ–°é¡µå‡ºç°â€ï¼‰
- ä»»æ„æ–°é¡µå‡ºç°å ä½å¡ï¼ˆ`page_placeholders_ready` æˆ– â€œè¯¥é¡µ cards ä» 0â†’>0â€ï¼‰åï¼Œâ‰¤1 æ¬¡è½®è¯¢å†…å¿…é¡»å¯è§è¯¥é¡µ **2â€“3 å¼ å ä½å¡é¢„è§ˆ**ã€‚
- ä»»æ„ä¸€é¡µ `page_done` åï¼Œâ‰¤1 æ¬¡è½®è¯¢å†…è¯¥é¡µå¡ç‰‡è¿›å…¥åˆ¤å®šæ€ï¼ˆå¯¹/é”™/ä¸ç¡®å®š/æœªä½œç­”ï¼‰å¹¶æ›´æ–°é¡µæ‘˜è¦ã€‚

### 3) é”™é¢˜/å­˜ç–‘ä¼˜å…ˆè§†å›¾ï¼ˆå‡å°‘è®¤çŸ¥è´Ÿæ‹…ï¼‰
- é»˜è®¤å¯ç›´æ¥çœ‹åˆ°â€œé”™é¢˜/å­˜ç–‘å¡â€ï¼ˆå·¦å³æ»‘åŠ¨ï¼‰ï¼Œå¹¶å¯åˆ‡æ¢åˆ°â€œå…¨éƒ¨é¢˜å¡â€ã€‚
- ç‚¹é”™é¢˜å¡è¿›å…¥ Chat Drawer æ—¶ï¼Œè¯·æ±‚å¿…é¡»å¸¦ `context_item_ids=[item_id]`ã€‚

---

## IV. Backend Gapsï¼ˆå·²ç¡®è®¤éœ€è¡¥å…… / ä»¥ `implementation_plan_backend_gaps.md` ä¸ºå‡†ï¼‰

- P0ï¼šHistory/Submissions Listï¼š`GET /api/v1/submissions`ï¼ˆæ”¯æ’‘ Home Recent Activity + History åˆ—è¡¨ï¼›ä¸èƒ½ç”¨ `/mistakes` æ¨æ–­ï¼‰
- P0ï¼šChat Rehydrateï¼ˆAâ€‘8 / WLâ€‘P0â€‘013ï¼‰ï¼šå†å² submission ä¹Ÿèƒ½â€œé—®è€å¸ˆâ€ï¼Œä¸è¦æ±‚é‡ä¼ 
- P2ï¼šReports è‡ªç”±æ—¥æœŸèŒƒå›´ `start_date/end_date`ï¼ˆæš‚ç¼“ï¼Œä¸é˜»å¡ Stitch ä¸»é“¾è·¯ï¼›Phase 1 ç”¨ `window_days` é¢„è®¾çª—å£ + `submission_id` å•æ¬¡æŠ¥å‘Šï¼‰

---

## V. å“è´¨å¢å¼ºï¼ˆéé˜»å¡ / å¯é€‰ï¼‰

> ç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜åç«¯å£å¾„ã€ä¸å¼•å…¥æ–°ä¾èµ–é£é™©çš„å‰æä¸‹ï¼Œè®© UI æ›´â€œé«˜çº§æ„Ÿ/ç®€æ´æ„Ÿ/å¯ç”¨æ„Ÿâ€ã€‚
>
> å¯¹åº”å¯æ‰§è¡Œæ¸…å•ï¼š`homework_frontend/frontend_ui_ux_tasks.md`ï¼ˆP2ï¼‰ã€‚

### 1) Skeleton Loadingï¼ˆæ¨èï¼‰

- History/Mistakes/Reports åˆ—è¡¨åŠ è½½ï¼šç”¨éª¨æ¶å±æ›¿ä»£ spinnerï¼Œå‡å°‘â€œç©ºç™½ç„¦è™‘â€ã€‚
- åŸåˆ™ï¼šä¸å½±å“æ•°æ®å£å¾„ï¼›åªæå‡ä½“æ„Ÿã€‚

### 2) è½¬åœºä¸å¾®äº¤äº’ï¼ˆå¯é€‰ï¼‰

- é¡µé¢åˆ‡æ¢ï¼šè½»é‡ Push/Popï¼ˆå¯é€‰ Framer Motionï¼›ä¹Ÿå¯åªç”¨ CSS transitionï¼‰ã€‚
- æŒ‰é’®/å¡ç‰‡ç‚¹å‡»ï¼šactive æ€ç¼©æ”¾å›å¼¹ï¼ˆscale down â†’ backï¼‰ï¼Œæå‡â€œè§¦æ„Ÿâ€ã€‚
- Drawer/Modalï¼šè¿›å…¥/é€€å‡ºåŠ¨æ•ˆç»Ÿä¸€ï¼ˆé¿å…çªå…€é—ªç°ï¼‰ã€‚
