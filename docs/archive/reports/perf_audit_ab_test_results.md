# 性能与质量审计报告：/grade 图片输入策略 A/B 测试

**测试时间**: 2025-12-31 15:00 - 15:30  
**测试对象**: 单张数学作业图片 (IMG_0699 copy.JPG)  
**测试环境**: 本地 Dev (Doubao-Seed-1.6)

## 1. 核心结论

> [!TIP]
> **推荐策略**: **Variant B (Proxy)**
> *   **速度最快**: 总耗时 **405s** (比 Variant A 快 64s)。
> *   **预处理最高效**: Preprocess 耗时仅 75s (Variant A 为 139s)，主要节省在 VLM Locate 阶段。
> *   **稳定性**: 成功完成，Wrong Count = 6。

| 策略 (Variant) | 总耗时 (ms) | 预处理 (ms) | LLM 推理 (ms) | 结果状态 |
| :--- | :--- | :--- | :--- | :--- |
| **A: Direct URL** | 468,597 | 139,303 | 213,930 | ✅ Done (5 wrong) |
| **B: Proxy URL** | **404,845** | **74,850** | **202,279** | ✅ Done (6 wrong) |
| **C: Data URL** | 600,000+ | 105,092 | N/A | ❌ Timeout |

## 2. 详细耗时拆解 (Timings Breakdown)

### Variant A: Direct URL (`grade_url_...`)
*   **Total**: 468.6s
*   **Preprocess (139s)**:
    *   VLM Locate: 77.8s (较慢)
    *   Crop & Upload: 61.5s
*   **Compression**: 16.7s
*   **LLM Aggregation**: 213.9s

### Variant B: Proxy URL (`grade_proxy_...`)
*   **Total**: 404.8s (**Winner**)
*   **Preprocess (75s)**:
    *   VLM Locate: **48.7s** (显著快于 A)
    *   Crop & Upload: 26.1s
*   **Compression**: 4.6s (显著快于 A)
*   **LLM Aggregation**: 202.3s

### Variant C: Data URL (`grade_dataurl_...`)
*   **Total**: >600s (Hit SLA Timeout)
*   **Preprocess (105s)**:
    *   VLM Locate: 67.4s
    *   Crop & Upload: 37.7s
*   **Overhead**:
    *   `image_data_url_download_encode_ms`: 5.3s
*   **Failure**: 任务超时，未返回完整结果。

## 3. 建议

1.  **采用 Proxy 策略**: 在 `url` 和 `proxy` 之间，Proxy 模式在本次测试中表现出显著的性能优势（快 ~15%），且预处理更稳定。
2.  **弃用 Data URL**: 首图转 Base64 (Data URL) 的策略导致了任务超时，且增加了额外的编码开销，不建议在生产环境对大图使用。
3.  **关注 LLM 耗时**: 即使最快的策略，LLM 推理仍占用了 ~200s。后续优化重点应从 Input IO 转向 LLM Prompt/Token 优化或流式输出。

---
*Generated by Antigravity based on backend logs.*
