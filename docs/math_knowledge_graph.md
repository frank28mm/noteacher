# 数学知识图谱与知识点标签规范（v0）

本文档用于统一「知识点标签」的命名口径与层级结构，避免同义词/英文标签混入统计，保证报表的“薄弱知识点/趋势图”含义清晰一致。

定位说明：
- 本文档是**规范与方法的真源（SSOT）**：定义“应该怎么命名/怎么分层/怎么控粒度/怎么处理同义词与噪声”。
- 本文档**不是**穷举词表：数学知识点颗粒度非常细，不现实也不必要把所有叶子节点都写满；允许 LLM 在规则约束下生成更细的标签，但必须保持统一标准、可归一化、可汇总。

## 1. 标签命名规范（建议作为唯一口径）

- 标签语言：中文为主，避免 `Math/Geometry` 这类学科英文泛标签进入统计。
- 粒度：一个标签对应一个清晰的教学知识点（不要过泛，也不要过碎）。
- 统一同义词：把常见同义表达归并到一个“规范名”（canonical）。
- 组合规则：一道题可以有多个标签，但建议控制在 1–3 个（主标签 + 1–2 个辅助标签）。

### 1.1 推荐标签格式（层级化，但不强收口）

建议采用“层级路径”表达，便于统计时按“叶子/父级”汇总：

- 格式：`一级域/二级主题/三级知识点[/四级子点]`
- 分隔符：统一用 `/`（不要混用 `-`、`>` 等）
- 展示：UI 可默认展示最后一级（叶子），需要时可展开看全路径

示例：
- `代数/整式运算/幂的运算`
- `代数/整式运算/完全平方公式`
- `几何/三角形/相似三角形`
- `函数/一次函数/图像与性质`

不建议：
- `Math`、`Geometry`、`代数`（只有一级、过泛）
- `幂运算`、`指数运算`（不带路径且容易歧义；见 2）

### 1.2 同义词归并示例

- 规范名：`幂的运算`
  - 同义词：`幂运算`、`指数运算`（当其含义是指数律/幂的性质时）
- 规范名：`勾股定理`
  - 同义词：`毕达哥拉斯定理`、`Pythagorean theorem`

### 1.3 颗粒度控制规则（LLM 必须遵守的“大逻辑”）

目标：同一类题在不同批次/不同模型输出时，标签仍能被稳定合并统计；同时允许更细颗粒度，但不“发散成不可汇总”。

- **优先叶子**：能明确落到叶子知识点时，输出到叶子（如 `完全平方公式`、`平方差公式`）。
- **不确定就收敛到父级**：信息不足/题意不清时，宁愿输出上一级（如 `整式运算`）也不要编造过细叶子。
- **主次分明**：每题 1 个主标签（最能解释对错的知识点），最多 2 个辅标签（步骤/方法相关）。
- **多知识点题**：
  - 若错误明显来自其中一个知识点 → 主标签给该知识点；辅标签给另一个。
  - 若题目本身强耦合（例如“函数+几何”综合）→ 可以输出 2 个并列主标签，但必须都能归到图谱路径。
- **方法类标签（可选）**：如 `方法/代入消元`、`方法/配方法` 仅在它对错误解释力强时使用；避免把“方法”当主标签覆盖知识点。
- **禁止泛学科标签**：`数学/代数/几何` 这种只反映学科、不反映知识点的标签不用于统计（可作为内部 `subject`，但不进入 `knowledge_tags`）。

## 2. “幂运算” vs “指数运算” 到底有什么不同？

在中文教材/教学语境里，这两个词经常被混用，但严格来说存在两种常见指代：

1) **指“指数律/幂的性质”的运算规则（更贴近初中/高中代数）**  
例如：`a^m · a^n = a^(m+n)`、`(a^m)^n = a^(mn)`、`a^0 = 1`（a≠0）。  
这类内容建议统一标成：`幂的运算`（规范名）。

2) **指“指数函数/对数函数”这套函数与图像（更贴近高中函数）**  
例如：`y = a^x` 的单调性、图像、与对数 `log_a x` 的互逆关系。  
这类内容建议单独标成：`指数函数` / `对数函数`（不要用“指数运算”做函数标签）。

因此，在本项目的“知识点标签”里，建议把 `幂运算/指数运算` 归并为 `幂的运算`，并用更明确的 `指数函数/对数函数` 表达函数类知识点。

## 3. 数学知识图谱（从基础到高中，结构示例）

> 说明：这是“结构示例”，重点是**命名统一 + 层级清晰**；不要求穷举所有叶子节点。新增叶子知识点时，必须能挂到以下某条主干上。

### A. 数与运算（小学→初中基础）

- 数的认识：整数、小数、分数、百分数、负数、绝对值
- 基本运算：加减乘除、运算律、估算、约分与通分
- 比与比例：比、比例、比例尺、正比例/反比例（初中）

### B. 代数（初中→高中）

- 代数式：整式、同类项、代数式化简
- 方程与不等式：一元一次/二元一次、分式方程、一元二次方程、不等式与不等式组
- 函数（基础）：函数概念、图像与变换、一次/二次函数、反比例函数
- 因式分解：提公因式、公式法、十字相乘等
- 幂与指数：幂的运算、科学记数法
- 指数对数（高中）：指数函数、对数函数、指数/对数运算与换底
- 数列（高中）：等差数列、等比数列、求和公式
- 导数（高中）：导数概念、单调性、极值、导数应用（如最值）

### C. 几何（初中→高中）

- 平面几何：三角形（全等/相似）、四边形、圆（切线、弦、圆周角）
- 常用定理：勾股定理、相似三角形性质
- 立体几何（高中）：空间几何体、线面关系、体积与表面积
- 解析几何（高中）：直线与圆、圆锥曲线（抛物线/椭圆/双曲线）

### D. 三角与向量（高中）

- 三角函数：定义、诱导公式、图像、恒等变形
- 解三角形：正弦定理、余弦定理
- 向量：向量运算、数量积、向量与几何/解析几何结合

### E. 概率与统计（初中→高中）

- 统计：平均数/方差、统计图表、抽样与估计
- 概率：古典概型、条件概率、独立事件（高中）

## 4. 系统里“知识点”是怎么来的？（链路说明）

目前链路是：

1) **LLM 批改输出知识点标签**：在批改结果里，模型会给每道题输出 `knowledge_tags`（可能混入英文/同义词/过泛标签）。  
2) **facts_worker 做归一化**：`homework_agent/utils/taxonomy.py` 读取 `homework_agent/resources/knowledge_taxonomy_v0.json`，按 `deprecated/aliases` 映射并去重。  
3) **报表统计使用归一化后的标签**：薄弱知识点 TOP3、趋势图、错因统计等都基于这些标签聚合。

注意：当前 taxonomy 的 `unknown_policy` 为 `keep`，因此**不在词表中的新标签也会被保留**；这会导致“Math/Geometry”这类噪声标签混入统计，需要通过扩展 alias 或在 LLM 侧约束来收敛。

## 5. 新标签如何被“统一标准化”？（推荐流程）

这里强调“规则约束 + 可演进”，而不是强收口到固定词表：

1) **LLM 输出时遵守本规范**：中文 + 路径化 + 主次分明 + 不确定就收敛父级。  
2) **后处理归一化**（自动）：把高频同义词/英文/别名映射到规范名（见 `knowledge_taxonomy_v0.json` 的 `aliases`）。  
3) **人工校准**（迭代）：每周/每月查看“高频新标签”，对明显同义词/别名补充 alias；对过泛/噪声标签加入过滤规则；对确实需要的新叶子补充到本图谱结构示例里（挂到主干）。

> 经验规则：不要求把所有叶子写进图谱，但必须保证“同义词会被合并”，否则报表会被稀释得不可用。

## 6. 下一步落地建议（可选）

- 词表落地：扩充 `knowledge_taxonomy_v0.json` 的 `aliases`，把高频同义词统一到规范名（例如 `幂运算/指数运算 → 幂的运算`）。
- Prompt 约束（不做强收口）：在批改 prompt 中要求 `knowledge_tags` 必须遵循本文件的“层级化格式 + 颗粒度规则”，并禁止输出学科泛标签；允许输出新叶子知识点，但必须能挂在图谱主干上。
- UI 兜底：前端对明显噪声（ASCII-only、学科名）继续过滤，并对少量高频同义词做展示归一化（避免历史数据不一致）。
